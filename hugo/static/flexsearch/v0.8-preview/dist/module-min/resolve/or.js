import Resolver from"../resolver.js";import default_resolver from"./default.js";import{create_object,get_max_len}from"../common.js";Resolver.prototype.or=function(){const a=this;let b=arguments,c=b[0];if(c.then)return c.then(function(){return a.or.apply(a,b)});if(c[0]&&c[0].index)return this.or.apply(this,c);let d,e,f=[],g=[],h=0,i=0;for(let a,c=0;c<b.length;c++)if(a=b[c]){let b;if(a.constructor===Resolver)b=a.result;else if(a.constructor===Array)b=a;else if(a.index)a.resolve=!1,b=a.index.search(a).result;else if(a.and)b=this.and(a.and);else if(a.xor)b=this.xor(a.xor);else if(a.not)b=this.not(a.not);else{h=a.limit||0,i=a.offset||0,d=a.enrich,e=a.resolve;continue}f[c]=b,b.then&&g.push(b)}return g.length?Promise.all(g).then(function(){return a.result.length&&(f=[a.result].concat(f)),a.result=resolver(f,h,i,d,e,a.boostval),e?a.result:a}):(this.result.length&&(f=[this.result].concat(f)),this.result=resolver(f,h,i,d,e,a.boostval),e?this.result:this)};function resolver(a,b,c,d,e,f){if(!a.length)return a;if("object"==typeof b&&(c=b.offset||0,d=b.enrich||!1,b=b.limit||0),2>a.length)return e?default_resolver(a[0],b,c,d):a[0];let g=[],h=0,l=create_object(),m=get_max_len(a);for(let n,o=0;o<m;o++)for(let d,j=0;j<a.length;j++)if(d=a[j],d&&(n=d[o],n))for(let a,d=0;d<n.length;d++)if(a=n[d],!l[a]){if(l[a]=1,c){c--;continue}if(e)g.push(a);else{const b=o+(j?f:0);g[b]||(g[b]=[]),g[b].push(a)}if(b&&++h===b)return g}return g}